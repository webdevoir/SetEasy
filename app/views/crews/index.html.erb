<meta name="pdfkit-orientation" content="Landscape"/>
<div id='remote_container'></div>
<div class="container-fluid content_dashboard">
  <div class="no_pdf">
    <%= link_to "Add Crew Member", new_crew_path, data: {:remote => true, 'data-toggle' =>  "modal", 'data-target' => '#remote_container'}, class: "btn btn-primary exam_button", style: "width:auto;float: left"  %>
    <%= link_to "Download PDF", crews_path(format: "pdf"), target: :_blank, class: "btn btn-primary exam_button", style: "width:auto;float: left"  %>
    </div>
  <br />
  <br />
  <div class="table-responsive">
    <table class="table">
      <tr>

        <th>Name</th>
        
        <th>Role</th>
        <th>Phone</th>
        <th>Email</th>
        <th>Availability</th>
        <th>Days Worked</th>
        <th>Planned Work</th>
        <th>skills</th>
        <th>Notes</th>
        <th>Updated</th>
 
        <th>Manage</th>
      </tr>

       <% @crews.each do |crew|  %>
      <tr>
  
        <td><%= link_to crew.name, crew_path(crew) %></td>
        
        <td><%= crew.role %></td>
        <td><%= crew.phone %></td>
        <td><%= crew.email %></td>
        <td><%= crew.availability %></td>
        <% events_count = crew.events %>
        <% if events_count && events_count.length > 0
          past_count = events_count.where("start <= ?",  Date.today).count
          future_count = events_count.where("start > ?",  Date.today).count
         else 
          past_count = 0
          future_count = 0
         end %>
        <td><%= past_count %> (<%= link_to "view", crew_crew_events_path(crew) %>)</td>
        <td><%= future_count %> (<%= link_to "view", crew_crew_events_path(crew) %>)</td>
  
           <td>
              <% if crew.skills && crew.skills.length > 0 && crew.skills.kind_of?(Array) %>
                <% new_crew = [] %>
                <%  crew.skills.each do |crew| %>
                  <% if crew.length > 0 %>
                    <% new_crew.push(crew) %>
                  <% end %>
                <% end %>
                <%= new_crew.to_sentence %>
              <% elsif crew.skills %>
                <%= truncate(crew.skills, length: 15) %>
              <% else %>
                None
              <% end %>
            </td>
        
        <td><%= truncate(crew.notes, length: 10) %></td>
        <td><%= crew.updated_at.strftime("%b %d, %Y")  %></td>
  
        <td>(<%= link_to "edit", edit_crew_path(crew), data: {:remote => true, 'data-toggle' =>  "modal", 'data-target' => '#remote_container'} %>, <%= link_to "delete", crew_path(crew), method: :delete, data: {confirm: "Are you sure you want to delete #{crew.id}?"} %>)</td>
      </tr>
      <% end %>

    </table>
  </div>
  
            <hr>
</div>